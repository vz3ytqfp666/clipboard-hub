# Clipboard Hub

> ç®€ä½“ä¸­æ–‡ / English in one file.  
> æœ¬æ–‡æ¡£é¢å‘ï¼šæƒ³å¿«é€Ÿéƒ¨ç½² / äºŒæ¬¡å¼€å‘ / è¯»ä»£ç çš„äººã€‚

---

## é¡¹ç›®ç®€ä»‹ Â· Project Overview

**ä¸­æ–‡ï¼š**  
Clipboard Hub æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€Œäº‘å‰ªè´´æ¿ã€Web åº”ç”¨ï¼š  
æ‰“å¼€åŒä¸€ä¸ª URLï¼Œä½ çš„å¤šå°è®¾å¤‡å…±äº«åŒä¸€ä»½æ–‡æœ¬ç©ºé—´ã€‚é€‚åˆå­˜æ”¾ä»£ç ç‰‡æ®µã€å‘½ä»¤è¡Œæ¨¡æ¿ã€å¤‡å¿˜ã€è´¦å·å¤‡æ³¨ç­‰ä¸€åˆ‡ã€Œä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°æ‰“ä¸€éã€çš„å†…å®¹ã€‚

**English:**  
Clipboard Hub is a lightweight â€œcloud clipboardâ€ web app.  
All devices accessing the same URL share the same text space. It is designed for code snippets, shell commands, notes, credentials hints, or any text you donâ€™t want to re-type every time.

---

## åŠŸèƒ½æ¦‚è§ˆ Â· Features

- ğŸŒ **äº‘å‰ªè´´æ¿ / Cloud clipboard**  
  æ‰€æœ‰è®¿é—®åŒä¸€æœåŠ¡åœ°å€çš„è®¾å¤‡å…±äº«ä¸€ä»½æ–‡æœ¬åˆ—è¡¨ã€‚  
  All devices hitting the same URL share one clipboard list.

- ğŸ¯ **æç®€ UIï¼Œæ”¯æŒæ·±æµ…è‰²ä¸»é¢˜ / Minimal UI with dark & light themes**  
  åœ†è§’å¡ç‰‡å¸ƒå±€ã€é”®ç›˜æç¤ºã€æœç´¢ã€æ’åºã€è‡ªåŠ¨åŒæ­¥ã€‚  
  Rounded cards, keyboard hints, search, sorting, auto sync.

- ğŸ’¾ **æœ¬åœ° SQLite å­˜å‚¨ / Local SQLite storage**  
  é»˜è®¤ä½¿ç”¨ `instance/clips.db`ï¼Œæ–¹ä¾¿è‡ªæ‰˜ç®¡ã€å¤‡ä»½ã€è¿ç§»ã€‚  
  Uses SQLite (`instance/clips.db`) by default for easy self-hosting & backup.

- ğŸ§  **æœåŠ¡å±‚æŠ½è±¡ / Service-layer abstraction**  
  è·¯ç”±åªè´Ÿè´£ HTTP å’Œ JSONï¼Œä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨ `app/services`ã€‚  
  Routes only handle HTTP & JSON; business logic lives in `app/services`.

- ğŸ›¡ï¸ **åŸºç¡€å®‰å…¨ä¿éšœ / Basic security hardening**  
  - å†…å®¹åˆæ³•æ€§æ ¡éªŒ & é•¿åº¦é™åˆ¶  
  - ç»Ÿä¸€ JSON å“åº”åŒ…ï¼Œé”™è¯¯ä¿¡æ¯å¯é¢„æœŸ  
  - å®‰å…¨ HTTP å¤´ï¼ˆCSPã€X-Frame-Optionsã€Permissions-Policy ç­‰ï¼‰  
  - é™åˆ¶ä»…æ¥å—å¸¦ `X-Requested-With: XMLHttpRequest` çš„ API è¯·æ±‚  
  Content validation, length limits, security headers, and simple CSRF/form-post mitigation.

- ğŸ§© **å‰åç«¯æ¸…æ™°åˆ†å±‚ / Clear separation of concerns**  
  - Flask + SQLite è´Ÿè´£ API & æŒä¹…åŒ–  
  - ç°ä»£å‰ç«¯ï¼ˆES Modules + å•æ–‡ä»¶ CSSï¼‰è´Ÿè´£äº¤äº’å’ŒåŠ¨ç”»  
  Flask + SQLite power the API & persistence; a modern front-end (ES modules + single CSS entry) handles UI & animations.

---

## æŠ€æœ¯æ ˆ Â· Tech Stack

- **åç«¯ / Backend**
  - Python 3.x
  - Flask 3.x
  - SQLiteï¼ˆå†…ç½®äº Pythonï¼Œé›¶é¢å¤–ä¾èµ–ï¼‰

- **å‰ç«¯ / Frontend**
  - çº¯ HTML / CSS / åŸç”Ÿ JavaScript
  - ES Modulesï¼š`web/static/js/main.js`, `ui.js`, `api.js`
  - å• CSS æ–‡ä»¶ï¼š`web/static/css/main.css`ï¼ˆåŒ…å«æ·±æµ…è‰²ä¸»é¢˜ + åŠ¨æ•ˆï¼‰

- **é…ç½® / Config**
  - ç¯å¢ƒå˜é‡ï¼ˆå¯é€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡æˆ– `.env` æä¾›ï¼‰
  - ç»Ÿä¸€é…ç½®ç±»ï¼š`app/config.py`

---

## ç›®å½•ç»“æ„ Â· Directory Layout

**ç®€åŒ–ç›®å½•è¯´æ˜ï¼ˆåªåˆ—æ ¸å¿ƒï¼‰ï¼š**

```text
clipboard-hub/
â”œâ”€ app/                     # Flask åº”ç”¨æ ¸å¿ƒ
â”‚  â”œâ”€ __init__.py           # create_app å·¥å‚
â”‚  â”œâ”€ config.py             # é…ç½®ï¼ˆConfigï¼‰
â”‚  â”œâ”€ db.py                 # SQLite è¿æ¥ & schema åˆå§‹åŒ–
â”‚  â”œâ”€ models.py             # æ•°æ®æ¨¡å‹ï¼ˆClipï¼‰
â”‚  â”œâ”€ routes/               # è·¯ç”±ï¼ˆAPI + Webï¼‰
â”‚  â”‚  â”œâ”€ api_clips.py       # /api/clips* JSON API
â”‚  â”‚  â””â”€ web_views.py       # HTML é¡µé¢è·¯ç”±
â”‚  â”œâ”€ services/             # ä¸šåŠ¡é€»è¾‘
â”‚  â”‚  â””â”€ clips_service.py   # Clip å¢åˆ æ”¹æŸ¥é€»è¾‘
â”‚  â””â”€ security/             # å®‰å…¨ç›¸å…³
â”‚     â”œâ”€ headers.py         # å®‰å…¨ HTTP å¤´
â”‚     â””â”€ validators.py      # å†…å®¹æ ¡éªŒ
â”‚
â”œâ”€ web/
â”‚  â”œâ”€ templates/
â”‚  â”‚  â”œâ”€ base.html          # åŸºç¡€å¸ƒå±€
â”‚  â”‚  â””â”€ index.html         # é¦–é¡µ UI
â”‚  â””â”€ static/
â”‚     â”œâ”€ css/
â”‚     â”‚  â””â”€ main.css        # å…¨å±€æ ·å¼ & ä¸»é¢˜ & åŠ¨ç”»
â”‚     â””â”€ js/
â”‚        â”œâ”€ main.js         # å‰ç«¯å…¥å£ï¼ˆäº‹ä»¶ç»‘å®š + çŠ¶æ€ç®¡ç†ï¼‰
â”‚        â”œâ”€ ui.js           # çº¯ UI / åŠ¨æ•ˆé€»è¾‘
â”‚        â””â”€ api.js          # è°ƒç”¨åç«¯ API
â”‚
â”œâ”€ instance/
â”‚  â””â”€ clips.db              # é»˜è®¤ SQLite æ•°æ®åº“ï¼ˆè¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»ºï¼‰
â”‚
â”œâ”€ docs/
â”‚  â”œâ”€ REMOD.MD              # æœ¬æ–‡æ¡£ï¼ˆé¡¹ç›® READMEï¼‰
â”‚  â”œâ”€ API.MD                # API è¯´æ˜
â”‚  â””â”€ ARCHITECTURE.MD       # æ¶æ„è¯´æ˜
â”‚
â”œâ”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€ requirements.txt         # Python ä¾èµ–
â””â”€ run.py                   # å¯åŠ¨å…¥å£ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```

---

## ç¯å¢ƒè¦æ±‚ Â· Requirements

**ä¸­æ–‡ï¼š**

- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- `pip` å¯ç”¨
- æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ˆ`venv`ï¼‰

**English:**

- Python 3.10+
- Working `pip`
- Virtualenv (or `python -m venv`) recommended

---

## å¿«é€Ÿå¼€å§‹ Â· Quick Start

### 1. å…‹éš†ä»“åº“ Â· Clone repository

```bash
git clone <your-repo-url> clipboard-hub
cd clipboard-hub
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ Â· Create virtualenv

```bash
python -m venv .venv
# Windows PowerShell
.venv\Scripts\Activate.ps1
# æˆ– Windows cmd
.venv\Scriptsctivate.bat
# æˆ– Linux/macOS
source .venv/bin/activate
```

### 3. å®‰è£…ä¾èµ– Â· Install dependencies

```bash
pip install -r requirements.txt
```

### 4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰Â· Configure environment variables (optional)

ä½ å¯ä»¥ï¼š

- **æ–¹å¼ Aï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰**ï¼šåœ¨ç³»ç»Ÿç¯å¢ƒä¸­è®¾ç½®å˜é‡  
- **æ–¹å¼ Bï¼ˆå¼€å‘æ–¹ä¾¿ï¼‰**ï¼šå¤åˆ¶ `.env.example` ä¸º `.env`ï¼Œé…åˆ `flask run` ä½¿ç”¨

å¯é…ç½®é¡¹ï¼š

- `FLASK_ENV`  
  - `development` / `production`  
- `SECRET_KEY`  
  - ä¼šè¯å’Œå®‰å…¨ç›¸å…³å¯†é’¥ï¼Œç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¿®æ”¹  
- `CLIPS_DB_PATH`  
  - SQLite è·¯å¾„ï¼Œé»˜è®¤ `instance/clips.db`

ç¤ºä¾‹ï¼š

```bash
# Windows Powershell
$env:FLASK_ENV="development"
$env:SECRET_KEY="change-me"
$env:CLIPS_DB_PATH="instance/clips.db"
```

```bash
# Linux/macOS
export FLASK_ENV=development
export SECRET_KEY="change-me"
export CLIPS_DB_PATH="instance/clips.db"
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ Â· Run development server

**æ–¹å¼ Aï¼šç›´æ¥ç”¨ `run.py`ï¼ˆå½“å‰é»˜è®¤ï¼‰**

```bash
python run.py
```

é»˜è®¤ç›‘å¬ï¼š

- `http://127.0.0.1:5000/`

**æ–¹å¼ Bï¼šä½¿ç”¨ Flask CLIï¼ˆè‡ªåŠ¨åŠ è½½ .envï¼‰**

```bash
flask --app app:create_app --debug run
```

---

## ä½¿ç”¨è¯´æ˜ Â· How to Use

### é¦–é¡µå¸ƒå±€ Â· Home UI

**å·¦ä¾§ï¼šæ–°å»ºå‰ªè´´ / Left: create new clip**

- æ–‡æœ¬æ¡†æ”¯æŒå¤šè¡Œï¼Œé€‚åˆç²˜è´´ä»£ç ã€æ—¥å¿—ã€æŒ‡ä»¤
- åº•éƒ¨æ˜¾ç¤ºï¼š
  - å­—ç¬¦æ•° / è¡Œæ•°ç»Ÿè®¡
- æ”¯æŒå¿«æ·é”®ï¼š
  - `Ctrl + Enter`ï¼šæäº¤å¹¶ä¿å­˜ä¸ºæ–°çš„å‰ªè´´
- å³ä¸‹è§’æŒ‰é’®ï¼š
  - ã€Œä¿å­˜ã€ï¼šåˆ›å»ºæ–°çš„å‰ªè´´è®°å½•
  - ã€Œæ¸…ç©ºè¾“å…¥ã€ï¼šæ¸…ç©ºå½“å‰æ–‡æœ¬æ¡†å†…å®¹

**å³ä¾§ï¼šå‰ªè´´åˆ—è¡¨ / Right: clip list**

- æ˜¾ç¤ºæ‰€æœ‰å·²ä¿å­˜çš„å‰ªè´´ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
- æ”¯æŒï¼š
  - æœç´¢ï¼ˆå‰ç«¯è¿‡æ»¤ï¼‰
  - å‡åº / é™åºåˆ‡æ¢
  - å•æ¡æ“ä½œï¼š
    - ã€Œå¤åˆ¶ã€ï¼šå°†å†…å®¹å¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿
    - ã€Œç¼–è¾‘ã€ï¼šè¡Œå†…ç¼–è¾‘å½“å‰é¡¹å¹¶ä¿å­˜
    - ã€Œåˆ é™¤ã€ï¼šä»æ•°æ®åº“ä¸­åˆ é™¤è¯¥æ¡ç›®
- åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤ºï¼š
  - å½“å‰å±•ç¤ºæ¡ç›®æ•°
  - æ˜¯å¦å¯ç”¨è‡ªåŠ¨åŒæ­¥ç­‰

### åŒæ­¥è¡Œä¸º Â· Sync behavior

- **æ‰‹åŠ¨åˆ·æ–° / Manual refresh**
  - ç‚¹å‡»ã€Œåˆ·æ–°ã€æŒ‰é’®ï¼Œä»åç«¯é‡æ–°è·å–åˆ—è¡¨
- **è‡ªåŠ¨åŒæ­¥ / Auto sync**
  - å¯åˆ‡æ¢è‡ªåŠ¨è½®è¯¢æ¨¡å¼ï¼ˆæ¯éš”å‡ ç§’æ‹‰å–æœ€æ–°æ•°æ®ï¼‰
  - é€‚åˆå¤šè®¾å¤‡åŒæ—¶æ‰“å¼€ç½‘é¡µçš„åœºæ™¯

### å¤šè®¾å¤‡å…±äº« Â· Multi-device usage

- å°†æœåŠ¡éƒ¨ç½²åœ¨ä¸€ä¸ªä½ èƒ½è®¿é—®çš„åœ°å€ï¼ˆæ¯”å¦‚å†…ç½‘ IP æˆ–å…¬ç½‘åŸŸåï¼‰
- æ‰€æœ‰è®¾å¤‡ä½¿ç”¨ç›¸åŒåœ°å€è®¿é—®
  - å¦‚ï¼š`http://192.168.1.100:5000/`
- æ‰€æœ‰å‰ªè´´éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª SQLite æ•°æ®åº“ä¸­ï¼Œå®ç°å…±äº«

---

## é…ç½®è¯´æ˜ Â· Configuration Details

é…ç½®é›†ä¸­åœ¨ `app/config.py` çš„ `Config` ç±»ï¼š

- `SECRET_KEY`  
  - æ¥æºï¼šç¯å¢ƒå˜é‡ `SECRET_KEY`ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å¼€å‘å¯†é’¥  
  - ç”¨äº session / å®‰å…¨åŠŸèƒ½ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»è¦†ç›–

- `DEBUG`  
  - `FLASK_ENV == "development"` æ—¶ä¸º `True`  
  - æ§åˆ¶ Flask çš„ debug æ¨¡å¼

- `DB_PATH`  
  - æ¥æºï¼šç¯å¢ƒå˜é‡ `CLIPS_DB_PATH`ï¼Œå¦åˆ™ä¸º `instance/clips.db`  
  - SQLite æ•°æ®åº“è·¯å¾„

- `MAX_CLIP_LENGTH`  
  - é™åˆ¶å•æ¡å‰ªè´´æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰ï¼Œé»˜è®¤ `8000`

---

## å®‰å…¨è¯´æ˜ Â· Security Notes

- **å†…å®¹éªŒè¯ / Content validation**
  - `validators.validate_clip_content` ä¼šï¼š
    - å»é™¤ä¸¤ç«¯ç©ºç™½
    - æ ¡éªŒéç©º
    - æ ¡éªŒé•¿åº¦ä¸è¶…è¿‡ `MAX_CLIP_LENGTH`
  - ä¸æ»¡è¶³æ¡ä»¶æ—¶è¿”å› 400 é”™è¯¯

- **ç»Ÿä¸€å“åº”æ ¼å¼ / Unified JSON envelope**
  - æ‰€æœ‰ API ç»Ÿä¸€è¿”å›ï¼š
    - æˆåŠŸï¼š`{ "status": "success", "data": ... }`
    - å¤±è´¥ï¼š`{ "status": "error", "message": "..." }`

- **å®‰å…¨ HTTP å¤´ / Security headers**
  - é€šè¿‡ `register_security_headers` åœ¨æ¯ä¸ªå“åº”ä¸Šé™„åŠ ï¼š
    - `X-Content-Type-Options: nosniff`
    - `X-Frame-Options: DENY`
    - `Referrer-Policy: no-referrer`
    - `Permissions-Policy: geolocation=(), microphone=(), camera=(), payment=(), usb=()`
    - `Content-Security-Policy: default-src 'self'; script-src 'self'; ...`

- **é™åˆ¶ API è¯·æ±‚æ¥æº / Restrict API calls**
  - API ä½¿ç”¨ `require_ajax` è£…é¥°å™¨ï¼š
    - ä»…æ¥å—å¸¦ `X-Requested-With: XMLHttpRequest` çš„è¯·æ±‚
    - é˜²æ­¢æœ€æ™®é€šçš„è·¨ç«™è¡¨å•ã€Œè£¸ POSTã€æ”»å‡»

---

## æµ‹è¯• Â· Tests

ç›®å‰åŒ…å«åŸºç¡€æµ‹è¯•éª¨æ¶ï¼š

- `tests/test_api_clips.py`

è¿è¡Œæµ‹è¯•ï¼ˆåç»­è¡¥å……æµ‹è¯•ç”¨ä¾‹åï¼‰ï¼š

```bash
pytest
```

---

## éƒ¨ç½²å»ºè®® Â· Deployment Notes

**å¼€å‘ç¯å¢ƒ**  
`python run.py` æˆ– `flask --app app:create_app --debug run`

**ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š**

- ä½¿ç”¨ WSGI æœåŠ¡å™¨ï¼ˆå¦‚ gunicorn / uWSGI ç­‰ï¼‰æ‰˜ç®¡ Flask app
- å…³é—­ debugï¼ˆç¡®ä¿ `FLASK_ENV=production`ï¼Œæˆ–é…ç½®ç±»ä¸­è®¾ç½®ï¼‰
- æ”¾åœ¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰åé¢ï¼Œé…ç½® HTTPS
- å°†æ•°æ®åº“æ–‡ä»¶æ”¾åœ¨ä»…æœåŠ¡å™¨å¯è®¿é—®çš„ä½ç½®ï¼Œå¹¶å®šæœŸå¤‡ä»½

ç¤ºä¾‹ï¼ˆgunicornï¼‰ï¼š

```bash
pip install gunicorn
gunicorn "app:create_app()"
```

> æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä¿®æ”¹ `SECRET_KEY`ï¼Œå¹¶è€ƒè™‘å•ç‹¬çš„ç”¨æˆ·è®¤è¯ / æƒé™æ§åˆ¶é€»è¾‘ã€‚
